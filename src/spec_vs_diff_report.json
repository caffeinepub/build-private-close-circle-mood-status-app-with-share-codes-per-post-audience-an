{
  "kind": "spec_vs_diff_report",
  "version": "1.0",
  "generatedAt": "2026-02-05T18:59:07.765Z",
  "summary": "Frontend NotificationsPage adds a \"Mark all as read\" button and marks individual notifications as read before navigation, but the diff summary does not provide enough visible evidence that the required backend API and the centralized React Query mutation hook (with ['notifications'] invalidation) are implemented. Some acceptance-criteria details (loading indicator text/visual) are also not clearly evidenced due to truncation.",
  "missing_requirements": [
    {
      "id": "REQ-35",
      "requirement": "Backend (backend/main.mo) exposes a shared method to mark all of the authenticated caller’s notifications as read (only caller’s; traps if unauthorized) and frontend adds a centralized React Query mutation hook in frontend/src/hooks/useQueries.ts that calls it and invalidates ['notifications'] on success.",
      "reason": "backend/main.mo is heavily truncated and shows no visible new shared method for mark-all-as-read nor authorization enforcement for it. frontend/src/hooks/useQueries.ts is also truncated and does not show the new useMarkAllNotificationsAsRead hook implementation or query invalidation logic; NotificationsPage imports the hook, but the hook’s existence/behavior is not evidenced in the shown diff content.",
      "evidence": [
        "backend/main.mo (truncated; no mark-all method visible)",
        "frontend/src/hooks/useQueries.ts (truncated; no useMarkAllNotificationsAsRead implementation visible)",
        "frontend/src/pages/NotificationsPage.tsx (imports useMarkAllNotificationsAsRead but hook body not shown)"
      ]
    },
    {
      "id": "REQ-34",
      "requirement": "The \"Mark all as read\" button shows an in-progress state (disabled + loading indicator or text) while running.",
      "reason": "The snippet shows the button is disabled while pending, but the diff excerpt does not show any loading indicator or loading text (content is truncated after the disabled prop).",
      "evidence": [
        "frontend/src/pages/NotificationsPage.tsx (button disabled={markAllAsReadMutation.isPending} shown; loading indicator/text not visible due to truncation)"
      ]
    },
    {
      "id": "REQ-36",
      "requirement": "Mark-as-read for a single notification and mark-all should invalidate/refetch ['notifications'] so the bottom-nav badge updates immediately once unread reaches 0, and no other user’s notifications can be marked read.",
      "reason": "NotificationsPage calls a mutation before navigation, but the diff does not show the mutation hook implementation, its ['notifications'] invalidation behavior, or backend authorization/ownership enforcement for single-notification read updates.",
      "evidence": [
        "frontend/src/pages/NotificationsPage.tsx (uses useMarkNotificationAsRead().mutateAsync(notification.id) but invalidation not shown)",
        "frontend/src/hooks/useQueries.ts (truncated; hook implementations and invalidation not visible)",
        "backend/main.mo (truncated; authorization/ownership enforcement for notification mutations not visible)"
      ]
    }
  ],
  "hallucinated_features": [
    {
      "description": "Added toast success message \"All notifications marked as read\" after the mark-all operation.",
      "reason": "BuildRequest requires errors surfaced via standard toast/error UI, but does not request a success toast specifically; this is additional behavior beyond the explicit requirements.",
      "evidence": [
        "frontend/src/pages/NotificationsPage.tsx (toast.success('All notifications marked as read'))"
      ]
    },
    {
      "description": "Added a ProgressiveDisclosure section advertising push notifications as \"Coming soon\" on the Notifications page.",
      "reason": "This UI element is not requested by REQ-34/35/36 (and is unrelated to mark-all/mark-single behavior).",
      "evidence": [
        "frontend/src/pages/NotificationsPage.tsx (ProgressiveDisclosure trigger=\"Push Notifications — Coming soon\")"
      ]
    }
  ],
  "confidence": 0.56,
  "changed_files": [
    "backend/main.mo",
    "frontend-file-summaries.txt",
    "frontend/src/hooks/useQueries.ts",
    "frontend/src/pages/NotificationsPage.tsx",
    "project_state.json"
  ]
}